<!DOCTYPE html>
<html class = "risks">

<head>

	<title>Mortality Risks</title>
	<link href="style.css" type="text/css" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://d3js.org/d3.v5.min.js"></script>
<!-- <script src="main.js" defer></script>  -->

</head>

<body>

	<!-- parts on every page  -->

	<h3 class = "every_page">If <a href="risks.html">humanity</a> were one <a href = "risks.html">human</a>...</h3>

	<span onclick="window.location.href='adolescence.html'" class="navigate left every_page">&#8249;</span>
	<span onclick="window.location.href='prevention.html'" class="navigate right every_page">&#8250;</span>

	


	<div class = "risks row">
		<div class = "column3">
			<svg id = "bubble_chart" width="350" height="500" font-family="sans-serif" font-size="10" text-anchor="middle"></svg>
		</div>

		<div class = "column3">
			<h1 class = "title">Mortality Risks</h1>
 			
 			<svg id="human" width="183.3" height="600" text-anchor="middle" display="inline-block" margin="auto" position="relative" left="50%"></svg>
		</div>

		<div class = "column3">
			<div class = "intro_note">What exactly are the risks we must come to terms with in our adolescence?</div> 
			<div class = "intro_note"><br><br><br><br><br>Scroll over the bubble chart on the left to explore mortality and extinction risk factors.</div>

			<span id = "risk"></span>
			<span id = "hrisk"></span>
			<span id = "xrisk"></span>
			<span id = "prob"></span>

			<div id="buttons">

				<select id="country">
					<option value="53.25">Afghanistan</option>
					<option value="82.89">Australia</option>
					<option value="74.98">Brazil</option>
					<option value="76.31">China</option>
					<option value="79.5">Denmark</option>
					<option value="70.03">India</option>
					<option value="75.2">Malaysia</option>
					<option value="60.87">Nigeria</option>
					<option value="72.16">Russia</option>
					<option value="81.3" selected>United Kingdom</option>
					<option value="80.43">United States of America</option>
				</select>

				<select id="researcher">
					<option value="ID001" selected>Toby Ord</option>
					<option value="ID002">Pamlin & Armstrong</option>
				</select>

			</div>
			
		</div>

		
	</div>

	<!-- Trigger/Open The Modal -->
	<div class = "uncertaintyButton" id = "myBtn"><h3 class = "uncertaintySentence">&#9650; the data in this visualization have high uncertainty.</h3></div>

	<!-- down caret: &#9660; -->

	<!-- The Modal -->
	<div id="uncertaintyModal" class="modal">

	  <!-- Modal content -->
	  <div class="modal-content">
	    <span class="close">&times;</span>
	    <div class="modal-body">
		    <h3>uncertainty</h3>

		    <p>The forecast data in this visualization have high uncertainty.</p>

			<p>The existential risk (x-risk) forecasts for the coming century come from two sources: Toby Ord’s <a style = "font-style: italic;"href = "https://theprecipice.com/">The Precipice</a> and Dennis Pamlin and Stuart Armstrong's "<a href = "https://www.researchgate.net/publication/291086909_12_Risks_that_threaten_human_civilisation_The_case_for_a_new_risk_category">Global Challenges: 12 Risks that Threaten Human Civilisation, Global Challenges Foundation</a>." If you click between researchers in the dropdown option, you’ll see how different their forecasts are.</p> 

			<!-- <p class="uncertainty-quote">“[quote about level of uncertainty]” (Ord p)</p> 

			<p class="uncertainty-quote">“[quote about level of uncertainty]” (Pamlin and Armstrong p)</p>  -->

			<p>To view x-risk predictions and their probability distributions, and even contribute your own forecasts, check out this <a href="https://www.lesswrong.com/posts/6x9rJbx9bmGsxXWEj/forecasting-thread-existential-risk-1">Forecasting Thread</a>.</p> 

			<p>The estimates for the percentages by which various preventive measures reduce existential risk forecasts come from a survey of experts from the Future of Humanity Institute, the Center for Human-Compatible AI, and other affiliations. Each expert was given under 10 minutes to come up with these values. Unquestionably, these estimates are also quite uncertain.</p>  

			<p>If everything's uncertain, what's the point? Although all forecasts are inherently subject to a high degree of error, it is still important to attempt to forecast these risks and how various preventive measures may reduce them, so as A) to highlight priority areas and cases where the research community disagrees and B) to underline the urgency of starting to take action to mitigate them. The point is to act now, because the consequences of inaction are catastrophic.</p>  
	 	</div>
	  </div>


<!-- 	<div id="container"></div> -->

</body>


<script type="text/javascript">

$("body").keydown(function(e) {
  if(e.which == 37) { // left     
      $(".left").trigger("click");
  }
  else if(e.which == 39) { // right     
      $(".right").trigger("click");
  }
});


//-----------------uncertainty modal-----------------

// Get the modal
var modal = document.getElementById("uncertaintyModal");

// Get the button that opens the modal
var btn = document.getElementById("myBtn");

// Get the <span> element that closes the modal
var span = document.getElementsByClassName("close")[0];

// When the user clicks the button, open the modal 
btn.onclick = function() {
  modal.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
span.onclick = function() {
  modal.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
}


var svg1 = d3.select("body").select("#human"), 
	width = +svg1.attr("width");
 	height = +svg1.attr("height");

var longLineLength = 1000;
var bottomLineY = 450;  // 550 - 100 = 450

var longline = svg1.append("line")
    .attr("x1", (width - longLineLength) / 2 + longLineLength * 5/12)
		.attr("x2", (width - longLineLength) / 2 + longLineLength * 7/12)
		.attr("y1", bottomLineY).attr("y2", bottomLineY)
    .attr("stroke-width", 2)
    .attr("stroke", "#353b3c");

var humanityhuman = svg1.append("image")
  	.attr("x", width / 2 - 225 / 2 + 24)
  	.attr("y", 15) // 115 - 100 = 15
  	.attr("xlink:href", "crowd_human.png")
  	.attr("width", 1100/6)
  	.attr("opacity", 1);

var title = d3.select("body").select("h1")
	.style("opacity", 0);

title.transition().style("opacity", 1).duration(1000).delay(0);

var intro_notes = d3.select("body").selectAll(".intro_note")
	.style("opacity", 0);

intro_notes.transition()
	.style("opacity", 1)
	.duration(1000).delay((d, i) => 1000 + 1500 * i);


/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


let probExamples = [{"value": 6, "example": " roll a 2 with any die"}, {"value": 7, "example": "r friend was born on a Tuesday"}, {"value": 8, "example": " flip a coin Tails three times in a row"}]

let tobyord = [//{"risk": "total existential risk", "value": 0.167, "img": "1x.png"}, 
{"risk": "unaligned artificial intelligence", "value": 0.1, "img": "1ai.png"},
{"risk": "'naturally' arising pandemic", "value": 0.0001 , "img": "1naturalpandemic.png"}, 
{"risk": "engineered pandemics", "value": 0.03, "img": "1engpandemic.png"},
{"risk": "other anthropogenic risks", "value": 0.02, "img": "1anthro.png"}, 
{"risk": "nuclear war", "value": 0.001, "img": "1nuclear.png"},
{"risk": "climate change", "value": 0.001, "img": "1climate.png"}, 
{"risk": "supervolcanic eruption", "value": 0.0001, "img": "1supervolcano.png"},
{"risk": "asteroid or comet impact", "value": 0.000001, "img": "1asteroid.png"}, 
{"risk": "stellar explosion", "value": 0.000000001, "img": "1stellar.png"},
{"risk": "other environmental damage (not climate change)", "value": 0.001, "img": "1enviro.png"},
//{"risk": "total natural existential risk", "value": 0.0001, "img": "1x.png"}
{"risk": "unforseen anthropogenic risks", "value": 0.03, "img": "1uncertain.png"}] 

let pamlin = [{"risk": "artificial intelligence", "value": 0.05, "img": "1ai.png"}, 
{"risk": "global pandemic", "value": 0.000001, "img": "1naturalpandemic.png"},  
{"risk": "nuclear war", "value": 0.00005, "img": "1nuclear.png"}, 
{"risk": "climate change", "value": 0.0001, "img": "1climate.png"}, 
{"risk": "supervolcano", "value": 0.0000003, "img": "1supervolcano.png"}, 
{"risk": "major asteroid impact", "value": 0.0000013, "img": "1asteroid.png"},
{"risk": "synthetic biology", "value": 0.000001, "img": "1syntheticbio.png"}, 
{"risk": "nanotechnology", "value": 0.0001, "img": "1nanotech.png"}, 
{"risk": "ecological catastrophe", "value": 0.005, "img": "1enviro.png"}, 
{"risk": "uncertain risk", "value": 0.005, "img": "1uncertain.png"}]

let researchers = new Map();
researchers.set("Toby Ord", tobyord);
researchers.set("Pamlin & Armstrong", pamlin);



//BUBBLE CHART

d3.csv("data.csv").then(function(data) {
 	var hrisks = [];
 	data.forEach(function(d) {
    	d.risk = d.risk;
    	d.value = +d.value;
   		d.img = d.img;
   		hrisks.push(d);
   	});

   	console.log(hrisks);

   	console.log(data[0]);
  	console.log(hrisks[0]);

  	function riskMatching() {
  		var finalData = [];
		var finalfinalData = [];

  		console.log("data " + data);
  		console.log("data[0] " + data[0]);

  		hrisks = data.filter(function(d) {
  	  		return d.country.localeCompare(document.getElementById("country").options[document.getElementById("country").selectedIndex].text) == 0;
  		});

  		console.log(hrisks);
		console.log(hrisks[0]);

		let xrisks = researchers.get(document.getElementById("researcher").options[document.getElementById("researcher").selectedIndex].text);
	// console.log(data2);

		console.log(xrisks);

		finalData = xrisks.map(function(x) {
			var match = {}
			match.xrisk = x.risk;
			match.ximg = x.img;
		
			var value = parseFloat(x.value) * parseFloat(document.getElementById("country").options[document.getElementById("country").selectedIndex].value) / 100; // x-risk scaled to life expectancy, multiplied by years of life expectancy / 100 years

			console.log(value);

			var closest = hrisks[0];

			console.log(closest);

			hrisks.forEach(function(n) { 
				console.log(n);
				if (Math.abs(parseFloat(value) - parseFloat(n.value)) < Math.abs(parseFloat(value) - parseFloat(closest.value))) {
					console.log(n);
					console.log(n.risk);
					closest = {"risk": n.risk, "value": +n.value, "img": n.img};
					console.log(closest);
				};
			});
			match.hrisk = closest.risk;
			match.himg = closest.img;
			match.hvalue = closest.value;
			match.xvalue = value;
			match.value = parseFloat(value);
			//hrisks = hrisks. //delete closest;
			console.log(match);
			finalfinalData.push(match);
			console.log("length " + hrisks.length);
			for( var i = 0; i < hrisks.length; i++){ 
				if ( hrisks[i].risk.localeCompare(closest.risk) == 0) { 
					hrisks.splice(i, 1); 
				};
			};
			console.log("length " + hrisks.length);
			return match;
		});
		console.log(finalData);
		console.log(finalfinalData);
		return finalData;
  	}

 	function bubbleChart(data) {
 		// d3.select("body").append("p").data(data).text(function(d) {
 		// 	return "xrisk: " + d.xrisk + " ximg: " + d.ximg + " hrisk: " + d.hrisk + " himg: " + d.himg + " value: " + d.value;
 		// });

 		let format = d3.format(",d");

 		var svg = d3.select("body").select("svg"),
 			width = +svg.attr("width"),
 			height = +svg.attr("height");

 		let pack = d3.pack()
 			.size([width - 2, height - 2])
 			.padding(3);

	 		const root = d3.hierarchy({children: data})
	 			.sum(function(d) {return d.value; });

	 		const node = svg.selectAll(".node")
	    	.data(pack(root).leaves())              //returns array of descendant nodes of "root" that don't have children
	    	.enter().append("g")
	   			.attr("class", "node")
	      		.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });  // move the entire chart where you want it

	      	node.append("circle")
	      	   .attr("id", function(d) {return d.id; })
	      		.attr("r", function(d) {return d.r; })       // radius?
	      		.attr("fill-opacity", 0.0);

	      	node.append("clipPath")
	      		.attr("id", function(d) { return "clip-" + d.id; })  //give each data point a clipUid?
	      	.append("use")
	      		.attr("xlink:href", function(d) { return "#" + d.id; });

	      	node.append('image')
	 //     .attr('clip-path', function(d) { return "url(#clip-" + d.id + ")"; })
	 			.attr("class", "bubble")
	 			.attr('width', function(d) { return d.r*2; })
	 			.attr('height', function(d) { return d.r*2; })
	 			.attr('xlink:href', function(d) { return d.data.himg; })
	 			.attr("transform", function(d) { return "translate("+parseInt(-d.r)+" " +parseInt(-d.r)+ ")"; })
		   		.on("mouseover", function(d){    //switches to x-risk image on mouseover
		    		d3.selectAll(".intro_note").text("");
		    		d3.select(this)
		    			.attr("xlink:href", function(d) { return d.data.ximg; });
		    		d3.select("#risk").text("~1 in " + Math.round(1.0 / d.data.value) + " chance");
		    		d3.select("#hrisk").text("A person in " + document.getElementById("country").options[document.getElementById("country").selectedIndex].text + " will die of " + d.data.hrisk + ".");
		    		d3.select("#xrisk").text("Humanity will go extinct from "  + d.data.xrisk + " in that person's lifetime.");
		    		d3.select("#prob").text("This is the same as the chance you" + probExamples.find(function (n) { return n.value === Math.round(1.0 / d.value); }).example + ".");
		    		})
		    	.on("mouseout", function(d){     //switches back
		    		d3.select(this)
		    			.attr("xlink:href", function(d) { return d.data.himg; });
		    		d3.select("#risk").text("");
		    		d3.select("#hrisk").text("");
		    		d3.select("#xrisk").text("");
		    		d3.select("#prob").text("");
		    		});

    	node.append("title")
    	.text(d => `${d.data.hrisk === undefined ? "" : `${d.data.hrisk}`}${format(d.data.value)}`);
	}

	bubbleChart(riskMatching());

	function update() {
		let updata = riskMatching();
		console.log(updata);

 		svg = d3.select("body").select("#bubble_chart"),
 		width = +svg.attr("width"),
 		height = +svg.attr("height");

 		svg.selectAll("*").remove();

 		bubbleChart(updata);
	}

	document.getElementById("country").addEventListener("change", update);
	document.getElementById("researcher").addEventListener("change", update);

});


</script>

</html>