<!DOCTYPE html>
<html>

<head>

	<title>If humanity were one human...</title>
	<script src="https://d3js.org/d3.v5.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link href="style.css" type="text/css" rel="stylesheet">

</head>

<body>
	<div id = "intro">
		<div class = "t1">
			<a class="next close" href = "intro.html">&times;</a>
			<h1 style = "position: relative; text-align: center; top: 50px; left: 20px;" class = "title">Welcome!</h1>
		</div>

		<div class = "questions">
			<div class = "t2">
				<h2>Where do you live?</h2>
				<select id="country">
					<option value="53.25">Afghanistan</option>
					<option value="82.89">Australia</option>
					<option value="74.98">Brazil</option>
					<option value="76.31">China</option>
					<option value="79.5">Denmark</option>
					<option value="70.03">India</option>
					<option value="75.2">Malaysia</option>
					<option value="60.87">Nigeria</option>
					<option value="72.16">Russia</option>
					<option value="81.3">United Kingdom</option>
					<option value="80.43" selected>United States of America</option>
				</select>
			</div>

			<div class = "t3">
				<h2>How optimistic are you about the future of humanity?</h2>
				<div class = "smileys">
					<img src = "face1.png">
					<img src = "face2.png">
					<img src = "face3.png">
					<img src = "face4.png">
					<img src = "face5.png">
				</div>
			</div>
		</div>
		<div class = "t4">
			<a class="next continue" href = "intro.html" style = "position: relative; text-align: center;">continue &#8250;</a>
		</div>
	</div>

</body>

<script type="text/javascript">

//transition in

let box = d3.select("#intro");
let t1 = d3.select("body").selectAll(".t1");
let t2 = d3.select("body").selectAll(".t2");
let t3 = d3.select("body").selectAll(".t3");
let t4 = d3.select("body").selectAll(".t4");

box.style("background-color", "#eef0f2");
t1.attr("class", "transition").style("opacity", 0);
t2.attr("class", "transition").style("opacity", 0);
t3.attr("class", "transition").style("opacity", 0);
t4.attr("class", "transition").style("opacity", 0);

let transitions = d3.selectAll(".transition");


box.transition()
	.style("background-color", "white")
	.ease(d3.easeLinear)
	.duration(200)
	.delay(500);

transitions.transition()
	.style("opacity", 1)
	.ease(d3.easeLinear)
	.duration(200)
	.delay((d, i) => 500 + 200*i);

//cursor on clickable items

d3.select("#country").on("mouseover", function(){
    d3.select(this).style("cursor", "pointer");
});

d3.select(".smileys").selectAll("img").on("mouseover", function(){
    d3.select(this).style("cursor", "pointer");
});

//change opacity of smiley when clicked

d3.select(".smileys").selectAll("img").on("click", function(){
    d3.select(".smileys").selectAll("img").attr("class", "null"); //unclicks all the other smileys 
    d3.select(this).attr("class", "selected");
});

//store selected country and its life expectancy in local storage 

var chooseCountry = function() {
	localStorage.setItem("country", document.getElementById("country").options[document.getElementById("country").selectedIndex].text);
	localStorage.setItem("expectancy", document.getElementById("country").options[document.getElementById("country").selectedIndex].value);
}

document.getElementById("country").addEventListener("change", chooseCountry);

/*--------------------------------------------MISC CUT CODE----------------------------------------------*/

//CHILDHOOD

// var text4 = svg.append("text")
// 	.attr("font-family", "Georgia")
// 	.attr("font-weight", "bold")
// 	.attr("fill", "#c6c7c4")
// 	.attr("font-size", 18)
// 	.attr("y", 47)
// 	.attr("x", 165)
// 	.text("If humanity were one human...");

// 	let labels = svg => {
//   		let label = svg.append("g")
//      		.style("font", "bold 12px var(--sans-serif)")
//       		.style("font-variant-numeric", "tabular-nums")
//       		.attr("text-anchor", "start")
//     		.selectAll("text")
//     		.data(data)
//     .join(
//       enter => enter.append("text")
//         .attr("transform", d => `translate(${x((prev.get(d) || d).value)},${y((prev.get(d) || d).rank)})`)
//         .attr("y", y.bandwidth() / 2)
//         .attr("x", 2)
//         .attr("dy", "-0.25em")
//         .text(d => d.name)
//         .call(text => text.append("tspan")
//           .attr("fill-opacity", 0.7)
//           .attr("font-weight", "normal")
//           .attr("x", 2)
//           .attr("dy", "1.15em")),
//       update => update,
//       exit => exit.transition(transition).remove()
//         .attr("transform", d => `translate(${x((next.get(d) || d).value)},${y((next.get(d) || d).rank)})`)
//         .call(g => g.select("tspan").tween("text", d => textTween(d.value, (next.get(d) || d).value)))
//     )
//     .call(bar => bar.transition(transition)
//       .attr("transform", d => `translate(${x(d.value)},${y(d.rank)})`)
//       .call(g => g.select("tspan").tween("text", d => textTween((prev.get(d) || d).value, d.value))));
// }

// svg.selectAll("rect")
// 	.transition()
// 	.duration(0)
// .attr("opacity", 1)
// 	.delay(0);



// svg.selectAll("g")
// 	.data(data)
//  	.attr("transform", d => `translate(${x0(d["year"])},0)`)
// 	.selectAll("image")
// 	.join("image")
// 		.attr("xlink:href", i => humans[i])
// 		.attr("width", 1100 / 6)
// 		.attr("opacity", 1);

	// longline.transition()
	// 	.attr("x1", (width - longLineLength) / 2 + longLineLength * 5/6 + 50)
	// 	.duration(0)
	// 	.delay(0);

//setTimeout(barChart, 1000);
// var svg = d3.select("body").select("svg");


// svg.data(humans).append("image")
// 	.attr("xlink:href", function(d) {return d;})
//   	.attr("x", function(i) {return (1100.0 / 12) + (i * 1100.0/6);})
//   	.attr("y", 520);


//ADOLESCENCE

// page.transition().attr("gradientUnits", "objectBoundingBox")
 //    .attr("cx", 0)
 //    .attr("cy", 0)
 //    .attr("r", "60%").duration(1000).delay(0);

 //RISKS

 //imgs: add for other enviro damage! add for unforseen anthro! add for total natural! add for total anthro!

//{"risk": "other environmental damage (not climate change)", "value": 0.001, "img": "1x.png"}, {"risk": "unforseen anthropogenic risks", "value": 0.03, "img": "1x.png"}, {"risk": "total anthropogenic existential risk", "value": 0.17, "img": "1x.png"}

//imgs: add for synthetic biology! add for nanotechnology! add for ecological catastrophe! add for uncertain risks!
//{"risk": "synthetic biology", "value": 0.000001, "img": "1x.png"}, {"risk": "nanotechnology", "value": 0.0001, "img": "1x.png"}, {"risk": "ecological catastrophe", "value": 0.005, "img": "1x.png"}, {"risk": "uncertain risk", "value": 0.005, "img": "1x.png"}

// let data1 =
// 	[{"hrisk": "ischemic heart disease", "himg": "1heart.png", "xrisk": "total existential risk", "ximg": "1x.png", "value": 7},
// 	{"hrisk": "self-harm", "himg": "1selfharm.png", "xrisk": "unaligned artificial intelligence", "ximg": "1ai.png", "value": 4},
// 	{"hrisk": "maternal disorders", "himg": "1pregnancy.png", "xrisk": "'naturally' arising pandemics", "ximg": "1naturalpandemic.png", "value": 0.004},
// 	{"hrisk": "substance abuse disorders", "himg": "1drugs.png", "xrisk": "engineered pandemics", "ximg": "1engpandemic.png", "value": 1},
// 	{"hrisk": "chronic liver diseases", "himg": "1liver.png", "xrisk": "other anthropogenic risks", "ximg": "1anthro.png", "value": 0.9},
// 	{"hrisk": "intestinal nematode infections", "himg": "1intestines.png", "xrisk": "stellar explosion", "ximg": "1stellar.png", "value": 0.000000001},
// 	{"hrisk": "coal workers pneumoconiosis", "himg": "1lungs.png", "xrisk": "asteroid or comet impact", "ximg": "1asteroid.png", "value": 0.00004},
// 	{"hrisk": "maternal disorders", "himg": "1pregnancy.png", "xrisk": "supervolcanic eruption", "ximg": "1supervolcano.png", "value": 0.004},
// 	{"hrisk": "other drug use disorders", "himg": "1drugs.png", "xrisk": "nuclear war", "ximg": "1nuclear.png", "value": 0.04},
// 	{"hrisk": "other drug use disorders", "himg": "1drugs.png", "xrisk": "climate change", "ximg": "1climate.png", "value": 0.04},
// 	{}]

// window.onbeforeunload = function(e){
//     document.getElementById('human').className = 'humanRisksToRoom';
//     document.getElementById('risks').className = 'fadeOut';
// }

// makeBubbleChart();
// document.getElementById("country").addEventListener("change", makeBubbleChart);
// document.getElementById("researcher").addEventListener("change", makeBubbleChart);





// function riskMatching() {
// 	var hrisks = [];
// 	console.log(hrisks);

// 	var finalData = [];
// 	var finalfinalData = [];

// 	return d3.csv("test.csv").then(function(data) {
//  		data.forEach(function(d) {
//     		d.risk = d.risk;
//     		d.value = +d.value;
//    			d.img = d.img;
//    			hrisks.push(d);
//   		});
//   		console.log(data[0]);
//   		console.log(hrisks[0]);

//   		hrisks = data.filter(function(d) {
//   	  		return d.country.localeCompare(document.getElementById("country").options[document.getElementById("country").selectedIndex].text) == 0;
//   		});

//   		console.log(hrisks);
// 		console.log(hrisks[0]);

// 		let xrisks = researchers.get(document.getElementById("researcher").options[document.getElementById("researcher").selectedIndex].text);
// 	// console.log(data2);

// 		console.log(xrisks);

// 		finalData = xrisks.map(function(x) {
// 			var match = {}
// 			match.xrisk = x.risk;
// 			match.ximg = x.img;
		
// 			var value = parseFloat(x.value) * 1000 / parseFloat(document.getElementById("country").options[document.getElementById("country").selectedIndex].value);

// 			console.log(value);

// 			var closest = hrisks[0];

// 			console.log(closest);

// 			hrisks.forEach(function(n) { 
// 				console.log(n);
// 				if (Math.abs(parseFloat(value) - parseFloat(n.value)) < Math.abs(parseFloat(value) - parseFloat(closest.value))) {
// 					console.log(n);
// 					console.log(n.risk);
// 					closest = {"risk": n.risk, "value": +n.value, "img": n.img};
// 					console.log(closest);
// 				};
// 			});
// 			match.hrisk = closest.risk;
// 			match.himg = closest.img;
// 			match.value = (parseFloat(value) + parseFloat(closest.value)) / 2;
// 			//hrisks = hrisks. //delete closest;
// 			console.log(match);
// 			finalfinalData.push(match);
// 			return match;
// 		});
// 		console.log(finalData);
// 		console.log(finalfinalData);
// 		return finalData;
// 	});
// };
	// let data = d3.csv("test.csv");
 //  	console.log(data);
 //  	var hrisks1 = data.filter(function(d) {
 //  	  return d.country.localeCompare(document.getElementById("country").options[document.getElementById("country").selectedIndex].text) == 0;
 //  	});
 //  	var hrisks2 = hrisks.filter(function(d) {
 //  	  return d.country.localeCompare(document.getElementById("country").options[document.getElementById("country").selectedIndex].text) == 0;
 //  	});
 //  	console.log(hrisks1);
 //  	console.log(hrisks);
  	  // data.forEach(function(d) {
    	// console.log(d);
    	// console.log(d.country);
    	// console.log(document.getElementById("country").options[document.getElementById("country").selectedIndex].text);
    	// if (d.country.localeCompare(document.getElementById("country").options[document.getElementById("country").selectedIndex].text) == 0) {
    	// 	console.log("length " + hrisks.length);
    	// 	hrisks.push({country: d.country, risk: d.risk, value: d.value, img: d.img});
    	// }
  	  // });
  	// console.log("hrisks1[0] " + hrisks1[0]);
  	// console.log("hrisks[0] " + hrisks[0]);

  	//let finalData = [];
  	//console.log("finalData" + finalData);
	
	// console.log(xrisks);
	// xrisks.forEach(function match(x) {
	// 	//console.log("xrisk before math" + x.value);
	// 	x.value = parseFloat(x.value) * 1000 / parseFloat(document.getElementById("country").options[document.getElementById("country").selectedIndex].value);
	// 	//console.log("xrisk after math" + x.value);
	// 	//console.log("hrisks[0] " + hrisks[0]);
	// 	let closest = hrisks[0];
	// 	//console.log("closest1 " + closest);
	// 	hrisks.forEach(function findClosest(n) { 
	// 		if (Math.abs(parseFloat(x.value) - parseFloat(n.value)) < Math.abs(parseFloat(x.value) - parseFloat(closest.value))) {
	// 			closest = n;
	// 			console.log("closest " + closest);
	// 		};
	// 	});
	// 	delete hrisks[hrisks.indexOf(closest)];
	// 	//console.log(closest);
	// 	let match = {
	// 		xrisk: x.risk,
	// 		ximg: x.img,
	// 		hrisk: closest.risk,
	// 		himg: closest.img,
	// 		value: (parseFloat(x.value) + parseFloat(closest.value)) / 2
	// 	};
	// 	console.log("match" + match);
	// 	finalData[finalData.length] = match;
	// });

	//return finalfinalfinalData;



// function bubbleChart() {
// 	let data = riskMatching();

// 	console.log(data);

// 	d3.select("body").append("p").data(data).text(function(d) {
// 			return "xrisk: " + d.xrisk + " ximg: " + d.ximg + " hrisk: " + d.hrisk + " himg: " + d.himg + " value: " + d.value;
// 		});

// 	let format = d3.format(",d");

// 	var svg = d3.select("body").select("svg"),
//     	width = +svg.attr("width"),
//     	height = +svg.attr("height");

// 	let pack = d3.pack()
//     	.size([width - 2, height - 2])
//     	.padding(3);

//     const root = d3.hierarchy({children: data})
//     .sum(function(d) {return d.value; });

// 	const node = svg.selectAll(".node")
//     .data(pack(root).leaves())              //returns array of descendant nodes of "root" that don't have children
//     .enter().append("g")
//       .attr("class", "node")
//       .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });  // move the entire chart where you want it

//     node.append("circle")
//      .attr("id", function(d) {return d.id; })
//       .attr("r", function(d) {return d.r; })       // radius?
//       .attr("fill-opacity", 0.0);

//     node.append("clipPath")
//       .attr("id", function(d) { return "clip-" + d.id; })  //give each data point a clipUid?
//     .append("use")
//       .attr("xlink:href", function(d) { return "#" + d.id; });

//     node.append('image')
//  //     .attr('clip-path', function(d) { return "url(#clip-" + d.id + ")"; })
//       .attr('width', function(d) { return d.r*2; })
//       .attr('height', function(d) { return d.r*2; })
//       .attr('xlink:href', function(d) { return d.data.himg; })
//       .attr("transform", function(d) { return "translate("+parseInt(-d.r)+" " +parseInt(-d.r)+ ")"; })
//     .on("mouseover", function(d){    //switches to x-risk image on mouseover
//         d3.select(this)
//            .attr('xlink:href', function(d) { return d.data.ximg; });
//         d3.select("#risk").text("~" + d.value + "% chance");
//         d3.select("#hrisk").text("A person in " + document.getElementById("country").options[document.getElementById("country").selectedIndex].text + " will die of " + d.data.hrisk + ".");
//         d3.select("#xrisk").text("Humanity will go extinct from "  + d.data.xrisk + " in that person's lifetime.");
//         })
//     .on("mouseout", function(){     //switches back
//         d3.select(this)
//            .attr('xlink:href', function(d) { return d.data.himg; });
//         d3.select("#risk").text("");
//         d3.select("#hrisk").text("");
//         d3.select("#xrisk").text("");
//  		});

//     node.append("title")
//      .text(d => `${d.data.hrisk === undefined ? "" : `${d.data.hrisk}`}${format(d.value)}`);

// }


// bubbleChart();
// document.getElementById("country").addEventListener("change", bubbleChart);
// document.getElementById("researcher").addEventListener("change", bubbleChart);



// var values = ["dog", "cat", "parrot", "rabbit"];

// var select = document.createElement("select");
//   select.name = "pets";
//   select.id = "pets"

// for (const val of values) {
//     var option = document.createElement("option");
//     option.value = val;
//     option.text = val.charAt(0).toUpperCase() + val.slice(1);
//     select.appendChild(option);
// }


// document.getElementById("container").appendChild(select);

// hi();
// document.getElementById("country").addEventListener("change", hi);
// function hi () {
// 	d3.select("body").append("p").text(document.getElementById("country").options[document.getElementById("country").selectedIndex].text);
// }


//let d3 = require("d3@5")

//let data = d3.csvParse("test.csv", ({hrisk, himg, xrisk, ximg, value}) => ({hrisk, himg, xrisk, ximg, value: +value}))

//SCROLLDOWN OPTIONS 

// function GetSelectedValue(){
// 	var e = document.getElementById("country");
// 	var result = e.options[e.selectedIndex].value;

// 	document.getElementById("country").innerHTML = result;
// }

// function GetSelectedText(){
// 	var e = document.getElementById("country");
// 	var result = e.options[e.selectedIndex].text;

// 	document.getElementById("country").innerHTML = result;
// }

// let hrisks = [];

// function hrisksByCountry(data1) {
// 	hrisks = [];
// 	data1.forEach(function(d) {
//     if (d.country == GetSelectedText()) {
//     	hrisks.push(d);
//     }
//   });
// }

// function closestRisk(xrisk) {
// 	let closest = hrisks[0];
// 	hrisks.forEach(function(d) {
// 		if (abs(+xrisk.risk - +d.risk) < abs(+xrisk.risk - +closest.risk)) {
// 			closest = d;
// 		}
// 	});
// 	delete hrisks[hrisks.indexOf(closest)];
// 	return closest;
// }

// let finalData = [];
// let hrisks = [];

// let data1 = d3.csv("test.csv"); 
// data1.forEach(function(d) {
//     if (d.country == GetSelectedText()) {
//     	hrisks.push(d);
//     }
// });

// xrisks.forEach(function(x) {
// 	x.risk *= 1000 / GetSelectedValue();
// 	let h = closestRisk(x);
// 	let match = {
// 		xrisk: x.name;
// 		ximg: x.img;
// 		hrisk: h.name;
// 		himg: h.img;
// 		value: (x.risk + h.risk) / 2;
// 	}
// 	finalData.push(match);
// });


// let pack = function(data) { d3.pack()
//     .size([width - 2, height - 2])
//     .padding(3)
//   (d3.hierarchy({children: data})
//     .sum(function(d) {return d.value; }))};


// await FileAttachment("test@1.csv").text()

// let width = 400;
// let height = width;
  
// const svg = d3.select("#bubble_chart").append("svg")
//       .attr("viewBox", [0, 0, width, height])
//       .attr("font-size", 10)
//       .attr("font-family", "sans-serif")
//       .attr("text-anchor", "middle");



// data = d3.csv("test.csv").then(function(data) {
//  data.forEach(function(d) {
//    d.value = +d.value;
//  });
//  console.log(data[0]);
// });

// d3.csv("test.csv", function(d) {
//    d.value = +d.value;
// }, function(error, data) {
// 	if (error) throw error;

	
    // .on("mouseover", function(d){    //switches to x-risk image on mouseover
        
    // .on("mouseout", function(){     //switches back
        
    //     });

    



// const leaf = svg.selectAll(".node")
//     .data(root.leaves())              //returns array of descendant nodes of "root" that don't have children
//     .enter().append("g")
//       .attr("class", "node")
//       .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });  // move the entire chart where you want it




// leaf.append("circle")
//       .attr("id", function(d) {(d.leafUid = DOM.uid("leaf")).id})
//       .attr("r", function(d) {return d.r})       // radius?
//       .attr("fill-opacity", 0.0);
// //      .attr("fill", d => color(d.data.group));    //fill with color

// leaf.append("clipPath")
//       .attr("id", d => (d.clipUid = DOM.uid("clip")).id)  //give each data point a clipUid?
//     .append("use")
//       .attr("xlink:href", function(d) {return d.leafUid.href});

//could probably get rid of this
  
//  leaf.append("text")
//      .attr("clip-path", d => d.clipUid)
//    .selectAll("tspan")
//    .data(d => d.data.name.split(/(?=[A-Z][a-z])|\s+/g))    // format name
//    .join("tspan")        //group as a tspan (https://developer.mozilla.org/en-US/docs/Web/SVG/Element/tspan)
//      .attr("x", 0)       //x-coordinate of starting point of text 
//      .attr("y", (d, i, nodes) => `${i - nodes.length / 2 + 0.8}em`)
//      .text(d => d);      //name formatted in data function (4 lines up)



// leaf.append('image')
//     .attr('clip-path', d => d.clipUid)
//     .attr('width',d => d.r*2)
//     .attr('height',d => d.r*2)
//     .attr('xlink:href', d.data.himg))
//     .on("mouseover", function(d){    //switches to x-risk image on mouseover
//         d3.select(this)
//            .attr('xlink:href',"file:///Users/odelialorch/Desktop/risk%20icons/1x.png");
//         d3.select("#risk").enter().append('div').text(d.data.value "% chance");
//         d3.select("#hrisk").enter().append('div').text("A person in " + country + "will die of" + d.data.hrisk);
//         d3.select("#xrisk").enter().append('div').text("Humanity will go extinct from "  + d.data.xrisk + " in that person's lifetime.");
//         })
//     		.function
//     .on("mouseout", function(){     //switches back
//         d3.select(this)
//            .attr('xlink:href',d => d.data.himg);
//         d3.select("#risk").selectAll('div').remove();
//         d3.select("#hrisk").selectAll('div').remove();
//         d3.select("#xrisk").selectAll('div').remove();
//         });
//       //.attr('transform','translate('+parseInt(d.posx+config.avatar_size/2)+','+parseInt(d.posy+config.avatar_size/2)+')')
// //});







</script>

</html>